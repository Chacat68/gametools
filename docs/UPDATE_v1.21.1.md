# GameTools v1.21.1 更新说明

**发布日期**: 2025年11月13日  
**版本号**: v1.21.1  
**更新类型**: 功能优化

## 🎉 重要更新

### 灵活基准语言选择

**之前的限制**:
- ❌ 必须配置中文版才能导出
- ❌ 中文版作为唯一基准语言

**现在的灵活性**:
- ✅ **选择任意一种语言即可导出**
- ✅ 支持4种语言任选其一：中文、越南文、英文、泰文
- ✅ 系统自动以第一个配置的语言为基准

## 📋 功能变更详情

### 1. 智能基准语言选择

系统按以下优先级自动选择基准语言：

```
优先级1: 中文版 (cn)    ← 推荐
  ↓
优先级2: 越南文版 (vn)  ← 默认
  ↓
优先级3: 英文版 (en)    ← 额外支持
  ↓
优先级4: 泰文版 (th)    ← 额外支持
```

**选择规则**:
- 如果配置了中文版 → 使用中文版作为基准
- 如果只配置越南文版 → 使用越南文版作为基准
- 如果只配置英文版 → 使用英文版作为基准
- 如果只配置泰文版 → 使用泰文版作为基准

### 2. 使用场景扩展

#### 场景1: 完整多语言对照（推荐）
```
输入:
  ✅ 中文版: 10个文件
  ✅ 越南文版: 10个文件  
  ✅ 英文版: 10个文件
  ✅ 泰文版: 10个文件

结果: 以中文版为基准，生成完整对照表格
```

#### 场景2: 单语言提取（新增支持）
```
输入:
  ❌ 中文版: 未配置
  ✅ 越南文版: 10个文件
  ❌ 英文版: 未配置
  ❌ 泰文版: 未配置

结果: 以越南文版为基准，vn列有内容，cn/en/th列为空
```

#### 场景3: 部分语言对照
```
输入:
  ❌ 中文版: 未配置
  ✅ 越南文版: 10个文件
  ✅ 英文版: 10个文件
  ❌ 泰文版: 未配置

结果: 以越南文版为基准，vn和en列有内容，cn和th列为空
```

#### 场景4: 仅英文提取
```
输入:
  ❌ 中文版: 未配置
  ❌ 越南文版: 未配置
  ✅ 英文版: 10个文件
  ❌ 泰文版: 未配置

结果: 以英文版为基准，en列有内容，其他列为空
```

### 3. 输出表格结构

| 列名 | 说明 | 示例 |
|------|------|------|
| name | 文件名 | config_table |
| num | Excel位置 | F7 |
| cn | 中文文本（如配置） | 配置项 |
| vn | 越南文文本（如配置） | Cấu hình |
| en | 英文文本（如配置） | Configuration |
| th | 泰文文本（如配置） | การกำหนดค่า |

**注**: 未配置的语言列显示为空白

## 🔄 技术实现

### 代码变更

**修改文件**: `gui/gametools_unified.py`

**核心逻辑**:
```python
# 选择第一个有数据的语言作为基准
base_lang = None
lang_priority = ['cn', 'vn', 'en', 'th']

for lang in lang_priority:
    if lang in all_lang_data and all_lang_data[lang]:
        base_lang = lang
        break

# 基于选中的语言构建汇总数据
for file_name, file_data in base_data.items():
    for sheet_name, sheet_data in file_data.items():
        for item in sheet_data['items']:
            # 获取基准语言的文本
            base_text = item.get('text', '')
            
            # 查找其他语言对应位置的文本
            cn_text = base_text if base_lang == 'cn' else find_text(...)
            vn_text = base_text if base_lang == 'vn' else find_text(...)
            en_text = base_text if base_lang == 'en' else find_text(...)
            th_text = base_text if base_lang == 'th' else find_text(...)
```

## 📝 文档更新

### 更新的文件
1. `gui/gametools_unified.py` - 核心逻辑
2. `docs/TRANSLATION_EXTRACTOR_V2.md` - 使用说明
3. `version.py` - 版本信息
4. `README.md` - 功能描述

### 主要修改点
- ✅ 移除"中文版必须配置"的限制
- ✅ 添加"至少选择一种语言"的说明
- ✅ 更新基准语言选择逻辑说明
- ✅ 增加各种使用场景示例

## 💡 使用建议

### 最佳实践

1. **推荐配置中文版**
   - 虽然不再强制，但建议优先配置中文版
   - 中文版通常是主要的参考文本

2. **明确主要语言**
   - 如果中文不是主要语言，可以只配置越南文或其他语言
   - 系统会自动适应您的配置

3. **逐步扩展**
   - 可以先提取单一语言
   - 后续再添加其他语言进行对照

4. **检查结果**
   - 查看汇总表格确认基准语言
   - 空白列表示该语言未配置或未匹配

## ⚠️ 注意事项

### 保持一致性
- 各语言版本的文件名应保持一致
- Excel结构（工作表、行列）应保持一致
- 位置对齐才能正确匹配

### 文件组织建议
```
translations/
├── vn/          # 越南文版（如果作为基准）
│   ├── config_table.xlsx
│   └── skill_table.xlsx
├── en/          # 英文版（可选）
│   └── config_table.xlsx
└── th/          # 泰文版（可选）
    └── config_table.xlsx
```

### 常见问题

**Q: 如果我只有越南文版，能用吗？**  
A: 可以！选择越南文版路径即可，系统会以越南文为基准进行提取。

**Q: 不同语言的文件数量可以不一样吗？**  
A: 可以。系统以基准语言为准，其他语言没有匹配的文件会显示空白。

**Q: 如何知道用了哪种语言作为基准？**  
A: 查看日志输出，会显示"使用 xx 作为基准语言"。

**Q: 可以手动指定基准语言吗？**  
A: 目前按优先级自动选择。如果想用特定语言，只配置那一种即可。

## 🔮 未来规划

- [ ] 支持手动选择基准语言
- [ ] 支持更多语言（韩文、日文等）
- [ ] 支持自定义优先级顺序
- [ ] 导出多种格式（CSV、JSON等）

## 📞 反馈

如有问题或建议，请：
- 在GitHub提交Issue
- 联系开发团队

---

**gametools开发团队**  
2025年11月13日
