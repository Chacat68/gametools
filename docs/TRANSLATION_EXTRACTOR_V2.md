# 翻译提取工具 v2.0 使用说明

## 版本更新（v1.21.0）

### 主要变更

1. **语言配置调整**
   - 中文版：作为基准语言，必须配置
   - 越南文版：默认语言
   - 英文版：额外支持
   - 泰文版：额外支持
   - ~~已删除：韩文版、日文版~~

2. **输出格式重构**
   - 原格式：每种语言独立输出到子文件夹
   - **新格式**：生成统一汇总Excel表格 `翻译提取汇总.xlsx`

### 输出表格结构

| 列名 | 说明 | 示例 |
|-----|------|------|
| name | 文件名（不含扩展名） | config_table |
| num | Excel物理位置 | F7 |
| cn | 中文文本 | 配置项 |
| vn | 越南文文本 | Cấu hình |
| en | 英文文本 | Configuration |
| th | 泰文文本 | การกำหนดค่า |

## 使用方法

### 方式1：统一界面（推荐）

1. 启动统一界面
   ```bash
   python gui/gametools_unified.py
   ```
   或双击 `gui/启动gametools.bat`

2. 切换到"翻译提取"页签

3. 配置各语言路径
   - **中文版**：必选，作为基准
   - 越南文版、英文版、泰文版：可选
   - 每种语言可选择单个Excel文件或包含多个文件的目录

4. 设置输出目录（可选）
   - 如未设置，默认使用中文版的目录

5. 点击"开始提取"按钮

6. 查看结果
   - 实时显示提取进度
   - 完成后在输出目录查看 `翻译提取汇总.xlsx`

### 方式2：独立工具

1. 启动独立工具
   ```bash
   python tools/excel_text_extractor_gui.py
   ```

2. 配置步骤与统一界面相同

## 工作原理

### 1. 提取过程

```
┌─────────────┐
│ 中文版文件  │ ← 基准语言（必须）
└─────────────┘
      │
      ↓
   提取文本和位置
      │
      ├─→ [文件名] config_table
      ├─→ [位置] F7
      └─→ [文本] 配置项
      
┌─────────────┐
│ 越南文版文件│ ← 可选语言
└─────────────┘
      │
      ↓
   在相同位置查找
      │
      └─→ F7 → Cấu hình

┌─────────────┐
│ 英文版文件  │ ← 可选语言
└─────────────┘
      │
      ↓
   在相同位置查找
      │
      └─→ F7 → Configuration
```

### 2. 匹配逻辑

- 以**中文版**为基准，遍历所有文本
- 对每个文本，记录其：
  - 文件名（name）
  - Excel物理位置（num，如F7）
  - 中文内容（cn）
- 在其他语言版本中：
  - 查找相同文件名
  - 查找相同工作表
  - 查找相同物理位置
  - 提取对应文本

### 3. Excel位置定义

Excel位置使用标准的单元格引用格式：
- `A1` = 第1列第1行
- `F7` = 第6列第7行
- `Z10` = 第26列第10行

工具会自动计算并记录物理位置，确保跨语言精确匹配。

## 输出样例

### 汇总表格示例

| name | num | cn | vn | en | th |
|------|-----|----|----|----|----|
| config_table | F7 | 配置项 | Cấu hình | Configuration | การกำหนดค่า |
| config_table | F8 | 描述 | Mô tả | Description | คำอธิบาย |
| skill_table | C5 | 技能名称 | Tên kỹ năng | Skill Name | ชื่อทักษะ |

### 表格格式特点

1. **标题行样式**
   - 蓝色背景（#4472C4）
   - 白色粗体字
   - 居中对齐

2. **列宽自动调整**
   - name列：25字符宽
   - num列：10字符宽
   - 语言列（cn/vn/en/th）：40字符宽

## 注意事项

### ⚠️ 重要提示

1. **中文版必须配置**
   - 中文版作为基准语言，必须提供
   - 如果没有中文版数据，工具无法生成汇总表格

2. **文件名必须匹配**
   - 各语言版本的文件名应保持一致（不含扩展名）
   - 例如：`config_table_cn.xlsx` 和 `config_table_vn.xlsx`
   - 工具会去除语言后缀自动匹配

3. **工作表结构应一致**
   - 各语言版本的工作表名称和结构应保持一致
   - Excel物理位置应对应相同的内容

4. **支持的文件格式**
   - .xlsx（推荐）
   - .xls（旧版Excel格式）

### 💡 使用技巧

1. **批量处理**
   - 建议将同一类型的文件放在同一目录
   - 每种语言使用独立的目录组织

2. **文件组织建议**
   ```
   translations/
   ├── cn/          # 中文版目录
   │   ├── config_table.xlsx
   │   └── skill_table.xlsx
   ├── vn/          # 越南文版目录
   │   ├── config_table.xlsx
   │   └── skill_table.xlsx
   ├── en/          # 英文版目录
   │   └── config_table.xlsx
   └── th/          # 泰文版目录
       └── config_table.xlsx
   ```

3. **输出位置选择**
   - 建议选择一个专门的输出目录
   - 避免与源文件混在一起

## 常见问题

### Q1: 为什么某些语言的列是空的？

**A:** 可能的原因：
- 该语言版本未配置路径
- 文件名不匹配
- Excel物理位置不同
- 工作表名称不一致

### Q2: 如何确保文本正确匹配？

**A:** 
1. 确保各语言版本的Excel结构一致
2. 使用相同的模板创建不同语言版本
3. 保持行列结构对齐

### Q3: 可以只提取部分语言吗？

**A:** 
- 中文版是必需的
- 其他语言（越南文、英文、泰文）都是可选的
- 未配置的语言，对应列会保持空白

### Q4: 支持子目录扫描吗？

**A:** 
- 是的，选择目录时会自动递归扫描所有子目录中的Excel文件

### Q5: 生成的表格可以修改吗？

**A:** 
- 可以，生成的是标准Excel格式文件
- 可以直接在Excel中编辑、添加备注等
- 建议保留原始生成的文件作为备份

## 技术说明

### 文本提取规则

1. **跳过策划行**
   - 检测到第6行包含"策划"字样时跳过

2. **从第7行开始**
   - Excel物理行号从7开始提取（对应DataFrame索引6）

3. **过滤条件**
   - 跳过空值
   - 跳过纯英文（如字段名）
   - 仅保留包含中文或越南文的内容

4. **去重处理**
   - 基于文本内容自动去重
   - 保持第一次出现的顺序

### 性能特点

- **多线程UI**: 使用后台线程处理，界面不会卡顿
- **实时进度**: 显示当前处理的文件和进度百分比
- **内存优化**: 分文件处理，避免一次性加载所有数据
- **错误恢复**: 单个文件失败不影响其他文件处理

## 版本历史

### v2.0 (1.21.0) - 2025-11-12
- 🔄 重构输出格式为统一汇总表格
- 🌍 语言调整：删除韩文和日文，新增泰文
- 📊 优化表格格式和样式
- 🎯 改进匹配逻辑和性能

### v1.0 (1.20.0) - 2025-10-xx
- 🚀 首次发布多语言提取功能
- 支持5种语言独立提取
- 分语言输出到子文件夹

## 反馈与支持

如有问题或建议，请联系开发团队或提交Issue。

---

**gametools开发团队**  
版本：v1.21.0  
日期：2025-11-12
